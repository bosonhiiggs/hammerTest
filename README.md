# Реферальная система
Данный проект представляет собой простую реферальную программу для регистрации новых пользователей по номеру телефона. Проект был разработан на Django Rest Framework
## Стек технологий:
- Python 3.12
- Django 5.2.4
- Django Rest Framework (DEF) 3.16.0
- Postgres 14.18

## Установка и запуск проекта
1. Клонируйте проект
   ```
   git clone https://github.com/bosonhiiggs/hammerTest.git
   cd hammerTest
   ```
2. Создайте виртуальное окружение
   ```
   python -m venv venv
   source venv/bin/activat
   ```
3. Установите зависимости
   ```
   pip install -r requirements.txt
   ```
4. Настройте базу данных PostgreSQL
   - Создайте базу данный referral_db
   - Создайте пользователя referral_user
   - Дайте необходимые разрешения
   - Данные, с которыми необходимо создать БД можно взять из `.env` 
5. Выполните миграции БД
   ```
   python manage.py makemigrations
   python manage.py migrate
   ```
6. Создайте пользователя (если нужен доступ к админ-панели)
   ```
   python manage.py createsuperuser
   ```
7. Запустить сервер
   ```
   python manage.py runserver
   ```

    Сервер будет доступен по адресу `http://localhost:8000`.

## API Документация (Swagger / Redoc)
После запуска сервера документация доступна:
- Swagger UI: http://127.0.0.1:8000/api/schema/swagger-ui/
- ReDoc: http://127.0.0.1:8000/api/schema/redoc/

## Описание API endpointsё
Все endpoints находятся под префиксом `/api`
1. Запрос кода по указанного номера для авторизации/регистрации
   - URL: `/api/auth/request_code/`
   - Метод: `POST`
   - Разрешения `AllowAny` (без аутентификации)
   - Описание: Отправляет 4-х значный код по номеру телефона
   - Тело запроса (JSON)
   ```
    {
        "phone_number": "79001234567"
    }
    ```
   - Ответ (200 OK) 
   ```
    {
        "detail": "Код верификации отправлен на ваш номер телефона."
    }
   ```
2. Проверка кода и авторизация/регистрация
   - URL: `/api/auth/verify_code/`
   - Метод: `POST`
   - Разрешения `AllowAny` (без аутентификации)
   - Описание: Проверяет введенный код верификации. Если код верный и действительный, пользователь авторизуется (или регистрируется, если номер новый)
   - Тело запроса (JSON)
   ```
    {
        "phone_number": "79001234567",
        "code": "1234"
    }
   ```
   - Ответ (200 OK) 
   ```
    {
      'detail': 'Успешная авторизация'
    }
   ```
3. Профиль пользователя
   - URL: `/api/profile/`
   - Метод: `GET`, `PATCH`
   - Разрешения `IsAuthenticated`
   - Описание: 
     - GET: Возвращает информацию о профиле текущего аутентифицированного пользователя, включая его собственный инвайт-код, активированный им инвайт-код (если есть) и список номеров телефонов пользователей, которых он пригласил.

     - PATCH: (В текущей реализации используется только для активации инвайт-кода через отдельный эндпоинт, но теоретически может быть расширен для других полей профиля).
   - Ответ (200 OK) 
   ```
     {
         "phone_number": "79001234567",
         "invite_code": "ABCDE1",
         "activated_invite_code": null,  // или "XYZW23" если активирован
         "referred_users_phone_numbers": [
             "79001112233",
             "79004445566"
         ]
     }
    ```
4. Активация кода приглашения
   - URL: `/api/profile/activate_invite/`
   - Метод: `POST`
   - Разрешения `IsAuthenticated`
   - Описание: Позволяет текущему аутентифицированному пользователю активировать чужой инвайт-код. Пользователь может активировать только один инвайт-код. Нельзя активировать свой собственный код
   ```
     {
         "phone_number": "79001234567",
         "invite_code": "ABCDE1",
         "activated_invite_code": null,  // или "XYZW23" если активирован
         "referred_users_phone_numbers": [
             "79001112233",
             "79004445566"
         ]
     }
    ```
    - Тело запроса (JSON)
   ```
   {
       "invite_code": "XYZW23"
   }

   ```
   - Ответ (200 OK) 
   ```
   {
      "detail": "Код приглашения активирован",
      "activated_invite_code": "XYZW23"
   }
   ```
## Docker
В проекте есть файлы Dockerfile и docker-compose.yaml. 
1. Собрать контейнер
   ```
   docker compose build
   ```
2. Запустить контейнер
   
   ```
   docker compose up
   ```